
<%- include('partials/header') -%>
    <div class="container">
        <!-- this section contains the gamenight the user has created and has buttons for adding games and inviting other users -->
        <h1>welcome <%= user.userName %> </h1>
        <h2>My Game Nights</h2>

            <ul>
            <% userGameNights.forEach( el => { %>
                <div class="card green lighten-4">
                    <li class='userGameNights' data-id='<%= el._id %>'>
                        <!-- basic info about the gamenight -->
                        <h3 class="gameNightTitle"><%= el.title %></h3>
                            <p>Date:<%= el.date %> </p>
                            <p>Vote by: <%= el.voteByDate %> </p>
                            <p><%= el.description %> </p>

                            <h4>Invited</h4>
                            <!-- shows currently invited users -->
                            <% el.invitedIds.forEach(userid => { %>
                                <!-- finds user with matching id to gamenights invited user ids -->
                                <% user = users.find(ele => ele._id == userid ) %>
                                <p> <%= user.userName %>  </p>
                             <% }) %> 
                             <!-- input field for inviting new user -->
                            <div class="input-field inline">
                                <input class="inviteInput" type="text">
                                <button class="btn waves-effect waves-light inviteBtn" type="submit" name="userInvite">Send Invite
                                    <i class="material-icons right">send</i>
                                  </button>
                                <label for="email_inline">Email/username</label>
                              </div>
                             
                            <h4>Attending</h4>
                            <!-- shows users who accepted invites -->
                            <% el.attendingIds.forEach(userid => { %>
                                <!-- finds user with matching id to gamenights invited user ids -->
                                <% user = users.find(ele => ele._id == userid ) %>
                                <p> <%= user.userName %>  </p>
                             <% }) %> 
                            
                            <h4>Game Choices</h4>
                                <% el.games.forEach(game => { %>
                                <span> <%= game.title %> </span>
                                <% }) %>
                                <!-- TODO: make this a game add input -->
                                <div class="input-field inline">
                                    <input id="inviteInput" type="text">
                                    <button class="btn waves-effect waves-light" type="submit" name="action">Add Game
                                    </button>
                                    <label for="email_inline">Game Title</label>
                                </div>
                        <div class="right-align">
                        <a class="waves-effect waves-teal btn-flat red-text del">delete</a>
                        </div>
                    </li>
                </div>
            <% }) %>    
            </ul>
        <h2>Invites</h2>
            <% invitedGameNights.forEach( el => { %>
                <div class="card green lighten-4">
                    <li class='userGameNights' data-id='<%= el._id %>'>
                        <h3 class="gameNightTitle"><%= el.title %></h3>
                            <p>Date:<%= el.date %> </p>
                            <p>Vote by: <%= el.voteByDate %> </p>
                            <p><%= el.description %> </p>
                        <h4>Invited</h4>
                        <!-- shows invited users -->
                        <!-- invite accept and decline button logic -->
                        <% if (el.invitedIds.includes(user.id) && !el.attendingIds.includes(user.id)) { %>
                          <p> You were invited! Would you like to accept? </p>
                          <a class="waves-effect btn-flat green-text acceptBtn">Accept!</a> <a class="waves-effect  btn-flat red-text declineBtn">No thanks!</a>
                        <% } %>
                        <!-- shows users who accepted invites -->
                        <% el.invitedIds.forEach(userid => { %>
                            <!-- finds user with matching id to gamenights invited user ids -->
                            <% user = users.find(ele => ele._id == userid ) %>
                            <p> <%= user.userName %>  </p>
                         <% }) %> 

                        <h4>Attending</h4>
                        <!-- shows users who accepted invites -->
                        <% el.attendingIds.forEach(userid => { %>
                            <!-- finds user with matching id to gamenights invited user ids -->
                            <% user = users.find(ele => ele._id == userid ) %>
                            <p> <%= user.userName %>  </p>
                         <% }) %> 

                        <h4>Game Choices</h4>
                        <!-- shows game choices TODO: ADD VOTE BUTTONS -->
                            <% el.games.forEach(game => { %>
                            <span> <%= game.title %> </span>
                            <% }) %> 
                            </div>
                    </div>
                </li>
            </div>
        <% }) %>    
        <h2>Plan your own Game Night!</h2>

        <form action="/gamenight/createGameNight" method='POST'>
            <label for="gameNightTitle">Title</label>
            <input type="text" placeholder="Title" name='gameNightTitle'>
            <label for="gameNightDescription">Description</label>
            <input type="text" placeholder="Description" name="gameNightDescription">
            <label for="gameNightDate">Date</label>
            <input type="date" name="gameNightDate">
            <label for="gameNightTitle">Vote By Date</label>
            <input type="date" name="voteByDate">
            <input type="submit">
        </form>

        <a href="/logout">Logout</a>

        <script src="js/main.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    </div>
</body>
</html>